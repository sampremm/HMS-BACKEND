generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      Role
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patients   Patient[]   @relation("DoctorPatients")
  labReports LabReport[] @relation("LabStaffReports")
}

model Patient {
  id        Int        @id @default(autoincrement())
  name      String
  age       Int
  gender    String
  contact   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  doctorId  Int?
  doctor    User?       @relation("DoctorPatients", fields: [doctorId], references: [id])
  treatments Treatment[]
  bills      Bill[]
  labReports LabReport[]
}

model Treatment {
  id         Int      @id @default(autoincrement())
  description String
  date        DateTime @default(now())
  patientId   Int
  patient     Patient  @relation(fields: [patientId], references: [id])
}

model LabReport {
  id         Int      @id @default(autoincrement())
  fileUrl    String
  uploadedAt DateTime @default(now())

  patientId  Int
  patient    Patient @relation(fields: [patientId], references: [id])

  labStaffId Int
  labStaff   User    @relation("LabStaffReports", fields: [labStaffId], references: [id])
}

model Bill {
  id         Int      @id @default(autoincrement())
  amount     Float
  issuedAt   DateTime @default(now())
  pdfUrl     String?

  patientId  Int
  patient    Patient @relation(fields: [patientId], references: [id])
}

enum Role {
  ADMIN
  DOCTOR
  RECEPTION
  LAB
}
